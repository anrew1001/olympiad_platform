[build]
# Backend service configuration
[build.backend]
dockerfile = "backend/Dockerfile"
context = "backend"

[build.frontend]
dockerfile = "frontend/Dockerfile"
context = "frontend"

# Services configuration
[services.backend]
startCommand = ""  # Uses Dockerfile CMD (gunicorn)
buildCommand = ""  # Uses Dockerfile RUN steps
healthchecks.checks.http.path = "/docs"
healthchecks.checks.http.method = "GET"
variables.DATABASE_URL = "${{Postgres.DATABASE_URL}}"
variables.ENVIRONMENT = "production"
variables.NEXT_PUBLIC_API_URL = "https://${{RAILWAY_PUBLIC_DOMAIN}}"
expose = 8000

[services.frontend]
startCommand = ""  # Uses Dockerfile CMD (npm start)
buildCommand = ""  # Uses Dockerfile RUN steps
healthchecks.checks.http.path = "/"
healthchecks.checks.http.method = "GET"
expose = 3000

[services.postgres]
image = "postgres:16-alpine"
variables.POSTGRES_USER = "olympiad"
variables.POSTGRES_PASSWORD = "${{POSTGRES_PASSWORD}}"
variables.POSTGRES_DB = "olympiad"
expose = 5432
volumes.data = "/var/lib/postgresql/data"

# Dependencies
[services.backend.depends_on]
postgres = "required"

[services.frontend.depends_on]
backend = "required"
